
# TCP/IP 쉽게, 더 쉽게

가볍게 보고 있는데 생각보다 재밌어서 간단히 기록까지.

# CH3. 트랜스포트 계층

- 인터넷 계층이 컴퓨터까지 데이터를 전달했다면,
- 트랜스포트 계층은 컴퓨터로 들어온 데이터를 애플리케이션 계층으로 전달.
- 이 때 애플리케이션 식별은 포트 번호로.
- 포트 번호를 웰노운, 레지스터드, 다이나믹으로 나누어 설명.
- TCP의 경우 데이터 전송의 신뢰성을 위해,
- 데이터를 세그먼트 단위로 분할하고 전송 속도를 조정하며 필요시 재전송도.
- TCP 세그먼트는 데이터 본체에 더해 TCP 헤더가 붙음.
- 송신지 포트 번호, 수신지 포트 번호, 일련번호, 확인 응답 번호, 컨트롤 비트 등이 헤더에 포함.
- 커넥션을 맺는 과정은 3-way 핸드쉐이크이며 순서는 SYN(C) - ACK/SYN(S) - ACK(C)).
- 커넥션을 끊을 때는 FIN(C) - ACK(S) - FIN(S) - ACK(C).

![TCP 커넥션 다이어그램](https://farm1.staticflickr.com/440/18338404268_f693b065d4_o.png)

- 데이터 전송 과정에서 일련번호와 확인 응답 번호가 어떻게 바뀌는지도 소개.
- `일련번호의 최종값 - 1`은 송신 바이트 수이고 `확인 응답 번호 - 1`은 수신한 바이트 수.
- 응답을 기다리는 대신 연속으로 데이터를 몰아서 보내고 응답도 몰아서 받는 식으로 속도를 높이기도.
- 이렇게 연속으로 데이터를 주고 받을 때, TCP 헤더인 윈도우 사이즈에 가용한 버퍼를 송신 측에 통보.
- 이 버퍼에 맞게 송신 측은 흐름 제어를 하며 요청량을 조절함.
- 한편, UDP는 이런 별다른 처리가 없는 대신 빠름.
- 더불어 브로드캐스트와 멀티캐스트도 가능.
- 때로는 UDP에 부족한 흐름 제어나 혼잡 제어 기능을 애플리케이션 차원에서 구현하기도.

# CH4. 라우팅과 인터넷 계층

- 네트워크 인터페이스 계층과 협력하여,
- 송신지 컴퓨터의 데이터를 수신지 컴퓨터까지 전달함.

## IP

- 수신지 컴퓨터 식별에는 IP 어드레스가 사용됨.
- 보통 전화번호나 우편번호와 비교되곤 하는데,
- IP는 지리 정보가 아니라 소속 네트워크를 알려준다는 점이 다름.
- 라우터는 이런 네트워크들의 연결 정보를 관리하고 연결시켜줌.
- IP 어드레스 고갈 방지 대안으로 private, public 어드레스 언급.
- IPv4, IPv6, DNS 이야기도 잠깐 함.
- IPv4에서는 헤더에 TTL을 이용해서, IPv6는 홉 리미트를 이용해서 IP 패킷의 유통기한을 관리.
- 이 유통기한이 다 지나면 패킷을 소멸시켜, 네트워크를 계속 떠돌아다니며 혼잡하게 만드는 것을 방지.
- 통신 경로 상태에 따라 라우터가 MTU<sup>Maximum Transmission Unit</sup>를 보고 패킷을 분할해서 전송하기도.
- 참고로 IPv6는 애당초 라우터에서 데이터를 분할하지 않는 방식으로 사양이 만들어져 있으며 관련 필드는 선택적임.
- IP 어드레스(예컨대 192.168.1.100)는 네트워크 부(192.168.1)와 호스트 부(100)로 구성.
- 라우터는 네트워크 부를 보고 목적지가 같은 네트워크인지 여부를 판단.
- 이렇게 네트워크 부와 호스트 부를 구분할 때, 길이를 미리 정해 놓는 어드레스 클래스와, 길이를 유연하게 조정할 수 있는 서브넷 마스크 방식 존재.
- 참고로, C 클래스에서 서브넷 마스크를 쓰게 되면, 8비트 내에서 할당할 수 있는 호스트의 수가 적으므로, 일반적으로는 A나 B어드레스 세분화에 활용.

## 라우터

- 라우터의 역할은 네트워크 간의 패킷을 전달하는 것.
- 이런 라우터를 거쳐가며 최종 목적지까지 도달하는 것을 라우팅이라 함.
- 라우터는 내부에 저장하고 있는 라우팅 테이블을 이용해 라우팅 진행.
- 라우팅에는 정적 라우팅과 동적 라우팅이 있음.
- 정적 라우팅은 네트워크 관리자가 직접 수작업으로 라우팅 테이블을 설정.
- 동적 라우팅은 라우팅 프로토콜을 이용해 자동으로 경로 정보 수집 후 라우팅 테이블 설정.
- 네트워크의 수가 너무 많으므로 라우팅 테이블에 목적지 정보가 없을 수 있으며 이럴 땐 디폴트 라우터에게 물어보게 됨.
- 이 디폴트 라우터 정보가 바로 정적으로 설정되어 있음.

| 목적지 | 전달할 곳 |
| ----- | ------- |
| 64.X.0.0/24 | 라우터 3의 어드레스 |
| 23.X.0.0/24 | 라우터 2의 어드레스 |
| 118.X.0.0/24 | 라우터 1의 어드레스 |

- 동적 라우팅 알고리즘에는 거리 벡터형과 링크 상태형이 존재.
- 거리 벡터형은 목적지까지의 거리(경유하는 라우터의 수인 홉을 사용)를 계산해서 가장 적은 수의 경로를 선택.
- 링크 상태형은 네트워크의 통신 상태 정보를 맵으로 관리하면서 상태가 가장 좋은 경로를 선택. 복잡하고 변화가 잦은 네트워크에 사용.
- 규모 있는 네트워크에서는 몇 개의 네트워크를 하나로 묶어 AS(자율시스템<sup>Autonomous System</sup>) 단위로 관리하기도 함.
- 작은 라우터를 여러 번 거치는 대신 이렇게 큰 단위씩 이동하면 더 빠른 라우팅이 가능.
- AS 간에는 경로 벡터형인 BGP<sup>Border Gateway Protocol</sup>을, AS 안에서는 링크 상태형인 OSPF<sup>Open Shortest Path First</sup>를 사용한다고 함.

## ICMP

- ICMP<sup>Internet Control Message Protocol</sup> 프로토콜은 데이터 전송 중 장애 상황을 통보하는 데 사용.
- 예컨대, 패킷이 TTL 경과로 네트워크 상에서 소멸될 때 라우터가 송신 측으로 타입 11 ICMP 메시지를 보냄.
- 또한, 네트워크에 속한 라우터의 IP 어드레스를 알고 싶을 땐 타입 9와 10을 사용.

| 타입 | 의미 |
| --- | --- |
| 8   | 에코 요청. 수신 측 장비가 존재하는지 확인 |
| 0   | 에코 응답. 수신 측 장비가 존재함을 알림 |
| 3   | 데이터가 도착하지 않음 |
| 4   | 회선 상태 복잡 |
| 5   | 경로 상태가 최적이 아님 |
| 10  | 장비가 네트워크에 새로 연결됐을 때 라우터를 찾기 위해 사용 |
| 9   | 라우터가 10번에 대한 응답으로 사용 |
| 11  | 생존 기간이 지난 패킷을 삭제했음 |