
# 04/16

## 개발자 원칙

- [생각보다 좋아서 기록도 간단히 해보는 것으로](https://github.com/codehumane/what-i-learned/blob/master/book/%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%9B%90%EC%B9%99/README.md).
- [CH04. 나의 메이저 버전을 업그레이드하는 마이너 원칙들](https://github.com/codehumane/what-i-learned/blob/master/book/%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%9B%90%EC%B9%99/README.md#ch04-%EB%82%98%EC%9D%98-%EB%A9%94%EC%9D%B4%EC%A0%80-%EB%B2%84%EC%A0%84%EC%9D%84-%EC%97%85%EA%B7%B8%EB%A0%88%EC%9D%B4%EB%93%9C%ED%95%98%EB%8A%94-%EB%A7%88%EC%9D%B4%EB%84%88-%EC%9B%90%EC%B9%99%EB%93%A4).

## JPA transient 판단에 2차 캐시 검사

얼마 전 겪었던 문제 상황.

- 애플리케이션에서 직접 ID를 세팅하는 JPA 엔티티가 있었고,
- [Persistable#isNew](https://github.com/spring-projects/spring-data-commons/blob/main/src/main/java/org/springframework/data/domain/Persistable.java#L48)에서 참을 반환하는 상태였는데,
- [여기](https://github.com/aleksabl/hibernate-core/blob/master/hibernate-core/src/main/java/org/hibernate/event/internal/DefaultPersistEventListener.java#L121)서 detached라면서 `PersistableObjectException`이 발생.
- 어떻게 detached가 나지, 내가 detached를 잘 모르는구나 생각하며 좀 찾아봄.

그리고 [JPA 엔티티의 transient 검사에 2차 캐시도 확인하는 코드](https://github.com/aleksabl/hibernate-core/blob/master/hibernate-core/src/main/java/org/hibernate/persister/entity/AbstractEntityPersister.java#L4374) 발견.

- 엔티티를 persistent context에서 발견 못하고,
- ID도 애플리케이션이 직접 세팅하는 방식이다 보니,
- transient냐 detached냐를 구분하려는 위 코드를 타게 됨.
- 그런데 이 때 2차 캐시에서 키로 데이터 존재하는지 여부도 검사하는 것.
- 그리고 마침, 같은 값을 만드려는 요청이 다른 서버에 동시에 들어왔고, 이로 인해 2차 캐시에 데이터가 있었던 것.
- [이 코드](https://github.com/aleksabl/hibernate-core/blob/master/hibernate-core/src/main/java/org/hibernate/engine/internal/CacheHelper.java#L32)도 함께 보면 도움 됨.

# 04/18

## 개발자 원칙

- [덕업일치를 넘어서](https://github.com/codehumane/what-i-learned/blob/master/book/%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%9B%90%EC%B9%99/README.md#ch01-%EB%8D%95%EC%97%85%EC%9D%BC%EC%B9%98%EB%A5%BC-%EB%84%98%EC%96%B4%EC%84%9C).
- 전문가 정의와 후기 골드 러시 소개가 인상 깊음.
